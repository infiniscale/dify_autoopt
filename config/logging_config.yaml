# config/logging_config.yaml

# Dify自动化测试工具 - 日志配置文件

# 全局日志配置
logging:
  # 基础配置
  global:
    # 日志级别: TRACE, DEBUG, INFO, WARNING, ERROR, CRITICAL
    level: "INFO"

    # 日志格式: simple（简单文本）, structured（结构化JSON）
    format: "simple"

    # 是否自动捕获未处理异常
    catch_exceptions: true

    # 是否包含异常堆栈信息
    include_traceback: true

    # 异常信息最大长度
    max_exception_length: 1000

  # 输出配置
  outputs:
    # 控制台输出
    console:
      enabled: true
      level: "INFO"
      include_colors: true

    # 文件输出
    file:
      enabled: true
      level: "DEBUG"
      path: "logs"
      rotation: "daily"           # daily, weekly, monthly, 或者具体大小如 "100 MB"
      retention: "30 days"         # 保留时间
      compression: "zip"          # 压缩格式: zip, gzip, tar

    # 错误日志单独文件
    error_file:
      enabled: true
      level: "ERROR"
      path: "logs"
      filename: "error.log"
      rotation: "daily"
      retention: "90 days"
      compression: "zip"

  # 性能配置
  performance:
    # 是否启用异步模式
    async_mode: true

    # 缓冲区大小（字节）
    buffer_size: 8192

    # 刷新间隔（秒）
    flush_interval: 5

    # 异步队列最大大小
    max_queue_size: 10000

    # 是否启用批量写入
    batch_writes: true

    # 批量写入大小
    batch_size: 100

  # 上下文配置
  context:
    # 自动添加的上下文字段
    auto_fields:
      - "module"
      - "version"
      - "request_id"
      - "session_id"

    # 自定义上下文字段
    custom_fields:
      service: "dify_autoopt"
      team: "optimization"
      environment: "production"

  # 健康检查和监控
  health:
    # 错误通知webhook（可选）
    error_notification_webhook: null
      # url: "https://hooks.slack.com/..."
      # headers:
      #   Authorization: "Bearer token"

    # 异常时自动重试
    auto_retry_on_exception: true

    # 最大重试次数
    max_auto_retry_attempts: 3

    # 重试延迟（秒）
    retry_delay: 1.0

    # 性能监控阈值
    performance_thresholds:
      max_log_latency_ms: 100       # 最大日志延迟
      max_queue_size: 8000          # 最大队列大小
      max_memory_usage_mb: 500      # 最大内存使用量

  # 高级配置
  advanced:
    # 日志文件编码
    encoding: "utf-8"

    # 是否启用日志染色（不同级别不同颜色）
    colorize: true

    # 是否启用进程ID
    process_id: true

    # 是否启用线程ID
    thread_id: true

    # 日志过滤规则
    filters:
      # 排除某些模块的日志
      exclude:
        - "urllib3.connectionpool"
        - "requests.packages.urllib3"

      # 自定义过滤规则
      custom_rules:
        - condition: "module == 'noisy_module'"
          max_level: "WARNING"

  # 开发和调试配置
  development:
    # 是否启用详细调试信息
    verbose: false

    # 是否启用性能分析日志
    profile_performance: false

    # 是否记录所有HTTP请求/响应
    log_http_traffic: false

    # 是否记录SQL查询
    log_sql_queries: false

  # 生产环境特定配置
  production:
    # 是否启用日志采样（只记录部分日志以减少量）
    enable_sampling: false

    # 采样率（0.0-1.0）
    sampling_rate: 0.1

    # 关键日志不采样
    critical_logs_always: true

    # 外部日志服务配置
    external_logging:
      enabled: false

      # Elasticsearch配置
      elasticsearch:
        hosts: ["localhost:9200"]
        index_prefix: "dify_autoopt"
        bulk_size: 100

      # Prometheus配置
      prometheus:
        enabled: false
        port: 9090
        metrics_prefix: "dify_autoopt"